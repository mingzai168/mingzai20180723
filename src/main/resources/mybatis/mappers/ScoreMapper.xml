<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="cn.zttek.thesis.modules.mapper.ScoreMapper" >
  <resultMap id="BaseResultMap" type="cn.zttek.thesis.modules.model.Score" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="thesisid" property="thesisid" jdbcType="BIGINT" />
    <result column="mark1" property="mark1" jdbcType="DOUBLE" />
    <result column="comment1" property="comment1" jdbcType="VARCHAR" />
    <result column="mark1date" property="mark1date" jdbcType="TIMESTAMP" />
    <result column="mark2" property="mark2" jdbcType="DOUBLE" />
    <result column="comment2" property="comment2" jdbcType="VARCHAR" />
    <result column="mark2date" property="mark2date" jdbcType="TIMESTAMP" />
    <result column="mark3" property="mark3" jdbcType="DOUBLE" />
    <result column="comment3" property="comment3" jdbcType="VARCHAR" />
    <result column="mark3date" property="mark3date" jdbcType="TIMESTAMP" />
    <result column="valid" property="valid" jdbcType="BIT" />
    <result column="cdate" property="cdate" jdbcType="TIMESTAMP" />
    <result column="mdate" property="mdate" jdbcType="TIMESTAMP" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from score
    where id = #{id,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="cn.zttek.thesis.modules.model.Score" useGeneratedKeys="true" keyProperty="id" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into score (thesisid, mark1, comment1, 
      mark1date, mark2, comment2, 
      mark2date, mark3, comment3, 
      mark3date, valid, cdate, 
      mdate)
    values (#{thesisid,jdbcType=BIGINT}, #{mark1,jdbcType=DOUBLE}, #{comment1,jdbcType=VARCHAR}, 
      #{mark1date,jdbcType=TIMESTAMP}, #{mark2,jdbcType=DOUBLE}, #{comment2,jdbcType=VARCHAR}, 
      #{mark2date,jdbcType=TIMESTAMP}, #{mark3,jdbcType=DOUBLE}, #{comment3,jdbcType=VARCHAR}, 
      #{mark3date,jdbcType=TIMESTAMP}, #{valid,jdbcType=BIT}, #{cdate,jdbcType=TIMESTAMP}, 
      #{mdate,jdbcType=TIMESTAMP})
  </insert>
  <update id="updateByPrimaryKey" parameterType="cn.zttek.thesis.modules.model.Score" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update score
    set thesisid = #{thesisid,jdbcType=BIGINT},
      mark1 = #{mark1,jdbcType=DOUBLE},
      comment1 = #{comment1,jdbcType=VARCHAR},
      mark1date = #{mark1date,jdbcType=TIMESTAMP},
      mark2 = #{mark2,jdbcType=DOUBLE},
      comment2 = #{comment2,jdbcType=VARCHAR},
      mark2date = #{mark2date,jdbcType=TIMESTAMP},
      mark3 = #{mark3,jdbcType=DOUBLE},
      comment3 = #{comment3,jdbcType=VARCHAR},
      mark3date = #{mark3date,jdbcType=TIMESTAMP},
      valid = #{valid,jdbcType=BIT},
      cdate = #{cdate,jdbcType=TIMESTAMP},
      mdate = #{mdate,jdbcType=TIMESTAMP}
    where id = #{id,jdbcType=BIGINT}
  </update>
    <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, thesisid, mark1, comment1, mark1date, mark2, comment2, mark2date, mark3, 
    comment3, mark3date, valid, cdate, mdate
    from score
    where id = #{id,jdbcType=BIGINT}
  </select>
  <select id="selectAll" resultMap="BaseResultMap" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select id, thesisid, mark1, comment1, mark1date, mark2, comment2, mark2date, mark3, 
    comment3, mark3date, valid, cdate, mdate
    from score
  </select>

  <!-- =========================以下为手动添加===================================== -->
    <select id="listByTeacher" resultMap="cn.zttek.thesis.modules.mapper.ThesisExpandMapper.ThesisExpand">
        select ts.id, ts.topic, ts.teacherid, ts.studentid, ts.account as stuno, ts.username as stuname, s.id as scoreid,
        s.mark1 as mark, ts.viewerid
        from thesis_student ts LEFT JOIN score s on ts.id = s.thesisid right join upload u on ts.id=u.thesisid
        where ts.teacherid = #{teacherid} and ts.projid = #{projid}
    </select>

    <select id="listByViewer" resultMap="cn.zttek.thesis.modules.mapper.ThesisExpandMapper.ThesisExpand">
        select ts.id, ts.topic, ts.teacherid, ts.studentid, ts.account as stuno, ts.username as stuname, s.id as scoreid,
        s.mark2 as mark, ts.viewerid
        from thesis_student ts LEFT JOIN score s on ts.id = s.thesisid
        where ts.viewerid = #{viewerid} and ts.projid = #{projid} and s.mark1>=0
        order by ts.teacherid
    </select>


    <update id="saveAssign">
        UPDATE thesis t
        SET t.viewerid = #{viewerid}
        where t.id in (
            <foreach collection="list" item="tid" index="index" separator="," >
                #{tid}
            </foreach>
        )
    </update>


  <delete id="deleteByThesis">
    DELETE s FROM score s WHERE s.thesisid = #{thesisid}
  </delete>

  <select id="listByStudent" resultMap="cn.zttek.thesis.modules.mapper.ThesisExpandMapper.ThesisExpand">
    select ts.id, ts.topic, ts.teacherid, ts.studentid, ts.account as stuno, ts.username as stuname, s.id as scoreid,
    s.mark3 as mark,u.username as teacher
    from thesis_student ts LEFT JOIN score s on ts.id = s.thesisid left join user u on ts.teacherid=u.id
    where  ts.projid = #{projid} and ts.studentid in
    <foreach collection="studentids" index="index" item="item" open="(" separator="," close=")">
      #{item}
    </foreach>
  </select>
</mapper>